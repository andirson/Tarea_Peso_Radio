<!DOCTYPE html>
<html>
<head>
	
	<title>Semana11 - Leaflet </title>
	<link rel="stylesheet" href="lib/leaflet/leaflet.css" />
	<script src="lib/leaflet/leaflet.js"></script>

	<meta charset="utf-8">

	<link rel="stylesheet" href="lib/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.min.css" />
	<script src="lib/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.min.js"></script>
	
	<link rel="stylesheet" href="lib/leaflet-easybutton/easy-button.css" />
	<script src="lib/leaflet-easybutton/easy-button.js"></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


	<!-- importar libreria JQuery -->
	<script src="lib/jquery/jquery-3.4.1.js"></script>

	<!-- Importtar la libreria  jQuery Modal -->
	<!-- Se esta usando un CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

    <!--  CSS -->
	<style>
	/*	table, th, td {
  			border: 1px solid rgb(117, 0, 0);
		}
		*/		

	</style>
	


	
</head>
<body>

	<!-- Contenido HTML de la Ventana Modal -->
	<div id="ex1" class="modal">
		<p>Hola este contenido del ejemplo 1 de una ventana modal</p>
		<a href="#" rel="modal:close">Cerrar</a>
	</div> 

	<!--	
	<div id="ventana-reporte" class="modal">
		<p>Reportar por coordenadas</p>
		<form>
			<label for="cx_form">Coordenada X:</label><br>
			<input type="text" id="cx_form" name="cx_form"><br>
			<label for="cy_form">Coordenada Y:</label><br>
			<input type="text" id="cy_form" name="cy_form"><br>
			
			<label for="opciones_form">Seleccione de la lista:</label><br>
			<select id="opciones_form" name="opciones_form">
			<option value="op1">Opcion 1</option>
			<option value="op2">Opcion 2</option>
			<option value="op3">Opcion 3</option>
			<option value="op4">Opcion 4</option>
			</select>
			<br>

			<label for="nombre_form">Nombre Quien Reporta:</label><br>
			<input type="text" id="nombre_form" name="nombre_form"><br>

			<label for="valor_form">Valor (entre 1 y 100):</label>
  			<input type="number" id="valor_form" name="valor_form" min="1" max="100">

			<br>
			<input type="button" id="boton-envio-reporte" value="Enviar Reporte">
		  </form>
		  <div id="div_mensaje_ventana_reporte"></div>
	</div>
	-->
		<!--	
	<div class="container"></div>
		<div id="ventana_tarea" class="modal">
			<div class="row">
			<p>Aumento de peso en un radio</p>
			<form>
				<div class="row mb-3">
					<label for="cx_form" class="col-sm-2 col-form-label">Coordenada X:</label><br>
					<div class="col-sm-6"></div>
						<input type="text" class="form-control" id="cx_form" name="cx_form"><br>
					</div>
				</div>

				<label for="cy_form">Coordenada Y:</label><br>
				<input type="text" id="cy_form" name="cy_form"><br>

				<br>

				<label for="peso_form">Peso:</label><br>
				<input type="number" id="peso_form" name="peso_form"><br>

				<label for="radio_form">Radio:</label>
				<input type="number" id="radio_form" name="radio_form" min="1" max="100">

				<br>
				<input type="button" id="boton-envio-tarea" value="Enviar Reporte">
			</form>
			<div id="div_mensaje_ventana_tarea"></div>
		</div>
		</div>
	</div> 	-->

	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
		  <div class="modal-content" id="ventana_tarea">
			<div class="modal-header">
			  <h3 class="modal-title" id="exampleModalLabel">Aumento de peso en un radio</h3>
				<!--<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
			  	</button> -->
			</div>
			<div class="modal-body" >
			  <form>
				<div class="form-group">

				  <label for="cx_form" class="col-form-label">Coordenada X:</label><br>
				  <input type="text" class="form-control" id="cx_form" name="cx_form"><br>

				  <label for="cy_form" class="col-form-label">Coordenada Y:</label><br>
				  <input type="text" class="form-control" id="cy_form" name="cy_form"><br>

				  <label for="peso_form" class="col-form-label">Peso:</label><br>
				  <input type="number" class="form-control" id="peso_form" name="peso_form"><br>

				  <label for="radio_form" class="col-form-label">Radio:</label>
				  <input type="number" class="form-control" id="radio_form" name="radio_form" min="1" max="100">
  
				</div>
			  </form>
			  <div id="div_mensaje_ventana_tarea" class="bg-danger"></div>
			</div>
			<div class="modal-footer">
			  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
			  <button type="button" class="btn btn-primary" id="boton-envio-tarea">Enviar</button>
			</div>
		  </div>
		</div>
	  </div>




			
		<br>
	
	<!-- FIN Boton Ruteo entre dos puntos -->


	<!-- Lienzo del mapa -->
	


	<div class="row">
		<div class="col-sm-8 col-sm-offset-2">
			<div class="panel panel-danger">
				<div class="panel-heading">
					<div class="panel-title">
						<div class="row">
							<div class="col-sm-1">
								<img src="images/logo_uv.png" width="60px" height="85px">
							</div>
							<div class="col-sm-10">
								<h1 style= "text-align: center; color:rgba(149, 52, 52, 0.986);">Tarea peso y radio Geoinformacion</h1>
							</div>
						</div>
					</div>
				</div>

				<div>
					<p>
						<!-- Boton Ruteo entre dos puntos -->
						<input type="button" class="btn btn-default"  id="boton_ruteo" value="Calcula la Ruta m&aacute;s corta">
						<!-- Link para abir la ventana modal -->
						<a href="#ex1" class="btn btn-default" role="button" rel="modal:open">Abrir ventana modal</a>
						<!-- Link para abir la ventana modal -->
						<a href="#ventana_tarea" class="btn btn-default" role="button" rel="modal:open">Registrar reporte</a>
					</p>
				</div>

				<div class="panel-body">
					<div id="mapid" style="width: 100%; height: 500px; z-index:0;"></div>
					<div id="mensaje_que_cambia" class="p-3 mb-2 bg-light text-dark"></div>	
				</div>
				<div class="p-3 mb-2 bg-light text-dark" id="informacion_sobre_ruta"></div>
				<div class="panel-footer panel-danger">
					<div class="col-sm-6">
						<p style= "text-align: justify;">El visor representa la interacción de un mapa con la base de datos, mediante PHP y JavaScript, y el uso de herramientas como Leaflet y Bootstrap para la representación y funcionalidad del visor, hacia el usuario final.</p>
					</div>

					<div class="col-sm-6">
						<p style= "text-align: center";><b> Anderson Castañeda Trujillo - Codigo: 2005118-5751</b> </br>
						Especialización en Geomática - Geoinformación en la web </br>
						Universidad del Valle</p>
					</div>
				</br></br></br>
				</div>
			</div>

		</div>

	</div>


	<div id="mensaje_que_cambia"></div>



	<!-- Link para abir la ventana modal -->






<script>

	
	
	var basemaps = 
	{
		Grayscale: L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', 
		{
			maxZoom: 18,
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		}),
		
		Streets: L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
		{
			maxZoom: 19,
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		})
	};
  

	var wmsLayer = L.tileLayer.wms('http://ws-idesc.cali.gov.co:8081/geoserver/wms?service=WMS&version=1.1.0', 
	{
		layers: 'idesc:mc_comunas',
		attribution: 'IDESC',
		format: 'image/png',
		transparent: true
	});
	
	
	var mymap = L.map('mapid',
	{
		zoom: 10
	}).setView([3.42335,-76.52086], 13);
	
	
	basemaps.Grayscale.addTo(mymap);
	wmsLayer.addTo(mymap);
	
	
	
	var groupedOverlays = {
	  "Capas ideas": {
		"Comunas": wmsLayer
	  }
	};


	//hacer este cambio
	//L.control.groupedLayers(basemaps, groupedOverlays).addTo(mymap);
	
	var layerControl=L.control.groupedLayers(basemaps, groupedOverlays);
	layerControl.addTo(mymap);


	//Creo una variable booleana (bandera) para saber cuando se requiere el ruteo 
	var flag_ruteo=false;

	//Evento click para boton_ruteo
	$( "#boton_ruteo" ).click(function() 
	{
	  	//vuelo hacia univalle
		mymap.flyTo([3.372472, -76.533229], 16);
		alert( "Click sobre el Mapa, indicando el punto Inicial" );
	  	//Cambio de estado la vabriable bandera
		flag_ruteo=true;
	  	//Cambio el cursor del mouse sobre el mapa
	  	document.getElementById('mapid').style.cursor = 'crosshair';
	});



	
	
	var popup = L.popup();

	function onMapClick(e) {
		//Clase 10 - Comentar evento click y retorno de coordenadas
		//popup
		//	.setLatLng(e.latlng)
		//	.setContent("Usted realizo un Click en las coordenadas:  " + e.latlng.toString())
		//	.openOn(mymap);

		//Si doy click sobre el mapa, estando en true la variable bandera
		if(flag_ruteo)
		{
			rutaMasCortaEntreDosPuntos(e);
		}
	 else 
		if(flag_otro){
			funcionNueva();
		}
	else
		if(flag_registrar)
		{
			//caso para lanzar ventana modal una vez de click sobre el mapa
			lanzarVentanaRegistro(e);
		}
	}

	function funcionNueva(){
		alert("soy una funcion nueva");
		flag_otro=false;
	        document.getElementById('mapid').style.cursor = '';
	}

	mymap.on('click', onMapClick);

	
	//Para que el cursor retorne estado por defecto en el mapa
	mymap.on('mousedown', function (e) { document.getElementById('mapid').style.cursor = ''; });
	
	
	
	var helloPopup = L.popup().setContent('Mensaje desde boton');

	/*#########################
	BOTONES CON EASYBUTTON
	#########################*/ 

	L.easyButton('<img src="images/smile.png">', function(btn, map)
	{
		var coordenadas = [3.483820,-76.509149];
		map.setView(coordenadas);
		
		helloPopup.setLatLng(coordenadas).openOn(map);
	}).addTo( mymap );

	L.easyButton('<img src="images/icono1.png" width="20px">', function(btn, map)
	{
		//Recupero los edificios desde la base de datos		
		cargarEdificios();
		//hago zoom hacia univalle
		mymap.flyTo([3.372472, -76.533229], 16);
	}).addTo( mymap );


	L.easyButton('<img src="images/icono2.png" width="20px">', function(btn, map)
	{
		//Recupero los sitios de interes desde la base de datos		
		cargarSitiosInteres();
		//hago zoom hacia univalle
		mymap.flyTo([3.372472, -76.533229], 16);
	}).addTo( mymap );

	//Boton Ejemplo para mostrar evento click sobre el mapa
	var flag_otro=false;
	L.easyButton('<img src="images/icono4.png" width="20px">', function(btn, map)
	{
		document.getElementById('mapid').style.cursor = 'crosshair';
                flag_otro=true;
		mymap.flyTo([3.372472, -76.533229], 16);
	}).addTo( mymap );

    //Semana 13
	//Boton Ejemplo para registrar 
	var flag_registrar=false;
	L.easyButton('<img src="images/punto_inicio.png" width="20px">', function(btn, map)
	{
		document.getElementById('mapid').style.cursor = 'crosshair';
		flag_registrar=true;
		mymap.flyTo([3.372472, -76.533229], 16);
	}).addTo( mymap );

	//Boton limpiar
	L.easyButton('<img src="images/icono_limpiar.png" width="20px">', function(btn, map)
	{
		//Recupero los sitios de interes desde la base de datos		
		resetear_costos();
		//hago zoom hacia univalle
		mymap.flyTo([3.372472, -76.533229], 16);
	}).addTo( mymap );


	var capaGeojsonEdificios = L.geoJson();
	function cargarEdificios()
	{
		//Hago la peticion recupera-edificios-geojson mediante el metodo post a funciones.php		
		$.post("src/funciones.php",
			{
				peticion: 'recupera-edificios-geojson'
			},
			function(data, status){
				console.log("Datos recibidos: " + data + "\nStatus: " + status);
				if(status=='success')
				{
					//console.log(data);
					mymap.removeLayer(capaGeojsonEdificios); 
					geojsonFeatureEdificios= eval('('+data+')');
					capaGeojsonEdificios = L.geoJson(geojsonFeatureEdificios, {onEachFeature: onEachFeatureEdificio }).addTo(mymap);	
				}
			});	
	}

	//Solucion tarea -- Sitios de Interes
	var capaGeojsonSitiosInteres = L.geoJson();
	function cargarSitiosInteres()
	{
		//Hago la peticion recupera-sitios-interes-geojson mediante el metodo post a funciones.php		
		$.post("src/funciones.php",
			{
				peticion: 'recupera-sitios-interes-geojson'
			},
			function(data, status){
				console.log("Datos recibidos: " + data + "\nStatus: " + status);
				if(status=='success')
				{
					//console.log(data);
					mymap.removeLayer(capaGeojsonSitiosInteres); 
					geojsonFeatureSitiosInteres= eval('('+data+')');
					
					//Agrego la capa de puntos
					capaGeojsonSitiosInteres = L.geoJson(geojsonFeatureSitiosInteres, 
					{
						pointToLayer: function (feature, latlng) 
						{
							//Icons from https://mapicons.mapsmarker.com/
							var smallIcon = L.icon(
							{
							iconSize: [27, 27],
							iconAnchor: [13, 27],
							popupAnchor:  [1, -24],
							iconUrl: 'images/icono_'+feature.properties.type+'.png' 
						});
						
							return L.marker(latlng, {icon: smallIcon}); 
						},onEachFeature: onEachFeatureSitiosInteres 
						
					} ).addTo(mymap);

				}
			});	
	}
	

	var estiloPoligonoEdificiosDefecto = 
	{
		radius: 8,
		fillColor: "#ff7800",
		color: "#000",
		weight: 1,
		opacity: 1,
		fillOpacity: 0.8
	};
	
	
	var estiloPoligonoEdificioMouseEncima = 
	{
		radius: 8,
		fillColor: "#000000",
		color: "#000",
		weight: 1,
		opacity: 1,
		fillOpacity: 0.8
	};

	function onEachFeatureEdificio(feature, layer) 
	{
		//Asigno estilo a cada edificio		
		layer.setStyle(estiloPoligonoEdificiosDefecto);		
		console.log(feature.properties.name);
		if (feature.properties && feature.properties.name) {
			layer.bindPopup('<b>NOMBRE: </b> '+feature.properties.name+'<br><b>ID: </b>' +feature.properties.osm_id +'<br><b>AREA: </b>' +feature.properties.area_edif );
			
			layer.on('mouseover', function() 
			{ 
				//Se agrego para cambiar el color del elemento cuando se ubique el mouse 
				this.setStyle(estiloPoligonoEdificioMouseEncima);				
				$('#mensaje_que_cambia').html('<h1>'+feature.properties.name+'</h1>');
			});
		        layer.on('mouseout', function() 
			{
				$('#mensaje_que_cambia').html('<h1>&nbsp;</h1>');
				this.setStyle(estiloPoligonoEdificiosDefecto);
			});	
		}
	}
	

	//Para cada edificio
	function onEachFeatureSitiosInteres(feature, layer) 
	{
		//Asigno estilo a cada edificio		
		console.log(feature.properties.name);
		if (feature.properties && feature.properties.name) 
		{
			var mensaje = '<b>NOMBRE: </b> '+feature.properties.name;
			mensaje +='<br><b>ID: </b>' + feature.properties.osm_id;
			mensaje +='<br><b>TIPO: </b>' +feature.properties.type;

			layer.bindPopup(mensaje);
		}
	}
	

	//RUTA MAS CORTA ENTRE DOS PUNTOS ( CLASE 10 )

	var conteoClicks=1;
	var coordenadasPuntoInicial = {};
	var coordenadasPuntoFinal = {};
	var puntoInicialMarcador = L.marker();
	var puntoFinalMarcador = L.marker();

	//Defino estas variables de forma global
	var nuevasCoordenadasPuntoInicial = {};
	var nuevasCoordenadasPuntoFinal = {};

	//creo los iconos

	var puntoInicialIcono = L.icon(
	{
		iconSize: [27, 27],
		iconAnchor: [13, 27],
		popupAnchor:  [1, -24],
		iconUrl: 'images/punto_inicio.png' 
	});

	var puntoFinalIcono = L.icon(
	{
		iconSize: [27, 27],
		iconAnchor: [13, 27],
		popupAnchor:  [1, -24],
		iconUrl: 'images/punto_final.png' 
	});


	//function para capturar punto inicial y punto final sobre el mapa 

	function rutaMasCortaEntreDosPuntos(e)
	{
		if(conteoClicks==2){
			coordenada_y = e.latlng.lat.toString();
			coordenada_x = e.latlng.lng.toString();
			coordenadasPuntoFinal={x:coordenada_x,y:coordenada_y};

			mymap.removeLayer(puntoFinalMarcador); 
			//puntoFinalMarcador = L.marker( [ coordenadasPuntoFinal['y'] , coordenadasPuntoFinal['x']  ]).addTo(mymap);

			//Solucion tarea
			//Agrego funcionalidad para que el punto final sea draggable 
			puntoFinalMarcador = L.marker( [ coordenadasPuntoFinal['y'] , coordenadasPuntoFinal['x']  ],
			{
			  draggable: true,
			  icon:puntoFinalIcono,
			}).addTo(mymap)
			.on('dragend', function() 
			{
				var nuevasCoordenadas = String(puntoFinalMarcador.getLatLng()).split(',');
				var lat = nuevasCoordenadas[0].split('(');
				var lng = nuevasCoordenadas[1].split(')');
				nuevasCoordenadasPuntoFinal={x:lng[0], y:lat[1]};

				//Actualizo las coordenadas del punto final
				coordenadasPuntoFinal=nuevasCoordenadasPuntoFinal;

				ejecutaCalculoRuteo(coordenadasPuntoInicial,nuevasCoordenadasPuntoFinal);
			});

			conteoClicks=1;
			flag_ruteo=false;
			document.getElementById('mapid').style.cursor = '';
			ejecutaCalculoRuteo(coordenadasPuntoInicial,coordenadasPuntoFinal);
		}else{
			document.getElementById('mapid').style.cursor = 'crosshair';
			coordenada_y = e.latlng.lat.toString();
			coordenada_x = e.latlng.lng.toString();
			coordenadasPuntoInicial={x:coordenada_x,y:coordenada_y};
			
			mymap.removeLayer(puntoInicialMarcador); 
			puntoInicialMarcador = L.marker( [ coordenadasPuntoInicial['y'] , coordenadasPuntoInicial['x']  ],
			{
			  draggable: true,
			  icon:puntoInicialIcono,
			}).addTo(mymap)
			.on('dragend', function() 
			{
				var nuevasCoordenadas = String(puntoInicialMarcador.getLatLng()).split(',');
				var lat = nuevasCoordenadas[0].split('(');
				var lng = nuevasCoordenadas[1].split(')');
				nuevasCoordenadasPuntoInicial={x:lng[0], y:lat[1]};

				//Actualizo las coordenadas del punto inicial
				coordenadasPuntoInicial=nuevasCoordenadasPuntoInicial;

				ejecutaCalculoRuteo(nuevasCoordenadasPuntoInicial,coordenadasPuntoFinal);
			});
			
			conteoClicks=conteoClicks+1;
			alert('Ingrese el punto de destino !');
		}
	}

	var contadorRutasGeneradas = 0;
	//Function que ejecuta el calculo de la ruta mas corta
	function ejecutaCalculoRuteo(pInicial,pFinal)
	{
		console.log(pInicial);
		console.log(pFinal);
		
			$.post("src/funciones.php",
			{
				//Ejecuto el caso genera-ruta-mascorta
				peticion: 'genera-ruta-mascorta',
				parametros: {  x1: pInicial.x,  y1: pInicial.y,  x2: pFinal.x,  y2: pFinal.y  }
			},
			function(data, status){
				console.log("Datos recibidos: " + data + "\nStatus: " + status);
				if(status=='success')
				{
					console.log(data);
					if(data=='NUEVA_RUTA_CREADA')
					{
						//Si se genero la ruta, ejecuto la funcion pintarRutaCreadaEntrePIniyPfin()
						pintarRutaCreadaEntrePIniyPfin();
						contadorRutasGeneradas = contadorRutasGeneradas+1;
					}
				}
			});
	}


	
	var capaGeojsonRuta = L.geoJson();
	var geojsonFeatureRuta;
	
	//Creo estilo para la linea que representara la ruta
	var miEstiloLinea1Ruta = {
		"color": "#ff0000",
		"weight": 6,
		"opacity": 0.8
	};
	//Pinto la ruta en el mapa
	function pintarRutaCreadaEntrePIniyPfin()
	{
		$.post("src/funciones.php",
		{
			peticion: 'recupera-ruta-geojson',
		},
		function(data, status)
		{
			console.log("Datos recibidos: " + data + "\nStatus: " + status);
			if(status=='success')
			{
				mymap.removeLayer(capaGeojsonRuta); 
				layerControl._update();
				geojsonFeatureRuta= eval('('+data+')');

				capaGeojsonRuta = L.geoJson(geojsonFeatureRuta,  {style: miEstiloLinea1Ruta  }).addTo(mymap);
				layerControl.addOverlay(capaGeojsonRuta,"Ruta mas Corta ("+ contadorRutasGeneradas + " )" ,"Rutas");
				mymap.addLayer(capaGeojsonRuta); 
				layerControl._update();
				capaGeojsonRuta.addTo( mymap );

				//Informacion Sobre la ruta pintada
				$.post("src/funciones.php",
				{
					peticion: 'info-ruta-creada',
				},
				function(data, status)
				{
					if(status=='success')
					{
						//Informacion Sobre la ruta pintada
						$('#informacion_sobre_ruta').html(data);
					}
				});


				
			}
		});
	}


	//Evento click para boton boton-envio-reporte
	$("#boton-envio-tarea").click(function() 
	{
		console.log('Enviar formulario y cerrar ventana modal');
		//capturar los datos del formulario

		var cx_ = $('#cx_form').val();
		var cy_ = $('#cy_form').val();
		var peso_ = $('#peso_form').val();
		var radio_ = $('#radio_form').val();

		//Hago la peticion registro-desde-ventana-modal mediante el metodo post a funciones.php		
		$.post("src/funciones.php",
			{
				peticion: 'registro-desde-ventana-modal', 
				parametros: {  x:cx_ ,  y: cy_,  peso: peso_ , radio: radio_  }
			},
			function(data, status){
				console.log("Datos recibidos: " + data + "\nStatus: " + status);
				if(status=='success')
				{
					if(data=='NUEVO_REPORTE_CREADO')
					{
					   $('#div_mensaje_ventana_tarea').html('<h2>Reporte Almacenado con exito !!</h2>');
					}else
					{
						$('#div_mensaje_ventana_tarea').html('<h2>No se pudo almacenar el reporte!</h2>');	
					}	
				}
			});	
		//Para cerrar la ventana modal	
		$.modal.close();
	});


	function lanzarVentanaRegistro(e)
	{
		// Capturo las coordenadas clickeadas sobre el mapa
		coordenada_y = e.latlng.lat.toString();
		coordenada_x = e.latlng.lng.toString();
		// Envio las coordenadas a los campos dentro del form
		$('#cx_form').val(coordenada_x);
		$('#cy_form').val(coordenada_y);

		//Limpio los campos del formulario
		$('#peso_form').val("");
		$('#radio_form').val("");
		$('#div_mensaje_ventana_tarea').html("");

		// lanzo ventana modal para registrar datos de reporte
		$('#ventana_tarea').modal(
			{
				closeExisting: false,
				escapeClose: false,
  				clickClose: false,
			});
	}

	
	function resetear_costos()
	{
		//Hago la peticion recupera-edificios-geojson mediante el metodo post a funciones.php		
		$.post("src/funciones.php",
			{
				peticion: 'limpiar_costos_ruta'
			},
			function(data, status){
				console.log("Datos recibidos: " + data + "\nStatus: " + status);
				if(status=='success')
				{
					console.log(data);	
				}
			});	
	}
	
	

</script>

</body>
</html>
